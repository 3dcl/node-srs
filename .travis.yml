language: node_js

node_js:
 - "0.10"
 - "0.8"

before_install:
 - sudo apt-get -qq update

install:
 - npm install mocha

before_script:
 - npm install
 - npm test

script:
 - make clean
 - sudo apt-get -qq install libgdal1-dev
 - npm install --shared_gdal
 - npm test
 - make clean
 - sudo apt-add-repository --yes ppa:ubuntugis/ubuntugis-unstable
 - sudo apt-get -qq update
 - sudo apt-get -qq install libgdal1-dev
 - npm install --shared_gdal
 - npm test
 - export NVER=`node -v`
 - export PATH=$(pwd)/node-${NVER}-linux-x86/bin:$PATH
 - if [[ "$NVER" != v0.6* ]]; then wget http://nodejs.org/dist/${NVER}/node-${NVER}-linux-x86.tar.gz; fi
 - if [[ "$NVER" != v0.6* ]]; then tar xf node-${NVER}-linux-x86.tar.gz; fi
 - if [[ "$NVER" != v0.6* ]]; then sudo apt-get -y install binutils:i386 cpp:i386 gcc-4.6:i386 g++-4.6:i386 libstdc++6-4.6-dev:i386 | true; fi
 - if [[ "$NVER" != v0.6* ]]; then CC=gcc-4.6 CXX=g++-4.6 npm install --target_arch=ia32; fi
 - if [[ "$NVER" != v0.6* ]]; then npm test; fi